
<!doctype>
<html>

<head>
<script type="text/javascript" src="web3.js"></script>
<script type="text/javascript">

var Web3 = require('web3');
var web3 = new Web3();
web3.setProvider(new web3.providers.HttpProvider("http://xxx:yyy"));

var messengerContract = web3.eth.contract([{"constant":true,"inputs":[{"name":"_receiver","type":"address"}],"name":"get_latest_message","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[{"name":"_receiver","type":"address"}],"name":"get_counter","outputs":[{"name":"","type":"uint32"}],"type":"function"},{"constant":true,"inputs":[{"name":"_receiver","type":"address"},{"name":"index","type":"uint32"}],"name":"get_message","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":false,"inputs":[{"name":"_receiver","type":"address"},{"name":"_text","type":"string"}],"name":"send_message","outputs":[{"name":"","type":"bool"}],"type":"function"},{"inputs":[],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_receiver","type":"address"}],"name":"Message_sent","type":"event"}]);

var messenger = messengerContract.at("0x48f9b0de84fa4339e6cbc270c771f0a6bc852585");

    function onMemberKeyUp() {
        var _receiver = document.getElementById('Postbox').value;
        try {
        	  var counter;
        	  var latest;
        	  counter = messenger.get_counter(_receiver);
        	  document.getElementById('number').innerText = counter;

        	  latest = messenger.get_latest_message(_receiver);
        	  document.getElementById('latest').innerText = latest;
        } catch (e) {
        	  console.log(e);
        }
    };

    function convertFromHex(hex) {
    	var hex = hex.toString();
    	var str = '';
    	for (var i = 0; i < hex.length; i += 2)
        		str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
    	return str;
    };

</script>
</head>
<body>

<h1>Messenger</h1>

	<h2>Postbox</h2>

    <div>
        <text>Member: </text>
        <input type="text" id="Postbox" onkeyup='onMemberKeyUp()'></input>
    </div>
    <div>
        <text>Number of messages: </text>
    	<text id="number"></text>
    </div>
    <div>
        <text>Latest message: </text>
    	<text id="latest"></text>
    </div>


</body>
</html>
